<!DOCTYPE html>
<html>
  <head>
    <title>Forest</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>
<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600">


<link rel="stylesheet" href="/fontawesome/css/all.min.css"/>



<link rel="stylesheet" href="/css/colortheme/colortheme.css"/>





  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" />

<meta property="og:title" content="Forest" />
<meta property="og:description" content="HackTheBox - Forest , Active Directory, SPN and DCSync" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://AlrikRr.github.io/posts/htb/easy/windows/forest/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-09-02T00:00:00+00:00" />



    
    
<meta name="description" content="HackTheBox - Forest , Active Directory, SPN and DCSync" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  


  




  
  
    
  
  



  
  
    
  
  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" alt="Logo">
      AlrikRr&#39;s Blog</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      
        <li class="nav-item dropdown">

<div id="theme-initialization" style="display: none;"
  default-theme="system"></div>
<a class="nav-link dropdown-toggle"  href="#" id="themeSelector" role="button"
  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  <img id="navbar-theme-icon-svg" src="/icons/moon-svgrepo-com.svg" width=20>
</a>
<div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby="themeSelector">
  <a class="dropdown-item nav-link" href="#" onclick="enableLightTheme()">
    <img class="menu-icon-center" src="/icons/sun-svgrepo-com.svg" width=20>
  </a>
  <a class="dropdown-item nav-link" href="#" onclick="enableDarkTheme()">
    <img class="menu-icon-center" src="/icons/moon-svgrepo-com.svg" width=20>
  </a>
  <a class="dropdown-item nav-link" href="#" onclick="useSystemTheme()">
    <img class="menu-icon-center" src="/icons/computer-svgrepo-com.svg" width=20>
  </a>
</div>
</li>
      
      </ul>
    </div>
  </div>
  
  
    <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/updates/">üßëüèº‚Äçüíª Personal Updates</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/updates/my-ejpt/" title="My eJPT feedback">My eJPT feedback</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/flipper-zero/">üê¨ Flipper Zero</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/flipper-zero/flipper-gpio/">Flipper Zero - GPIO</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/flipper-zero/flipper-gpio/uart-bridge-pi4/" title="UART Bridge RPi4 to Flipper">UART Bridge RPi4 to Flipper</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/flipper-zero/flipper-gpio/tty-shell/" title="USB to tty">USB to tty</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/8bits-computer/">üíæ 8 Bits Computer</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/8bits-computer/part1-clock/">Part 1 - Clock Module</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/1-astable555timer/" title="#1 Astable 555 Timer">#1 Astable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/2-monostable555timer/" title="#2 Monostable 555 Timer">#2 Monostable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/3-bistable555timer/" title="#3 Bistable 555 Timer">#3 Bistable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/4-clocklogic/" title="#4 Clock Logic">#4 Clock Logic</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/active-directory/">üñ• Active Directory Posts</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/active-directory/build-training-lab/">Build your Training Lab</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/active-directory/build-training-lab/1-domain/" title="#1 Setup the Domain and Workstations">#1 Setup the Domain and Workstations</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/active-directory/ad-attacks/" title="Hacking &amp; Attacks">Hacking &amp; Attacks</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/">üëæ Reverse Engineering</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/iot-hacking/">IoT Hacking</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/" title="D-Link - DCS-932L">D-Link - DCS-932L</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/iot-hacking/tplink-ac750/" title="#1 TP-Link AC750 Wifi Router">#1 TP-Link AC750 Wifi Router</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/binary-exploitation/">Binary Exploitation</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/buffer-overflow/" title="#1 Introduction to linux buffer-overflow 32-bit">#1 Introduction to linux buffer-overflow 32-bit</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/ret-2-win/" title="#2 ret2win exploit 32-bit linux">#2 ret2win exploit 32-bit linux</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/ret-2-libc/" title="#3 ret2libc exploit 32-bit linux">#3 ret2libc exploit 32-bit linux</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/">ü™≤ Malware</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/investigations/">Investigations</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/malware/investigations/kardon/" title="Kardon Loader">Kardon Loader</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/malware/investigations/vbs-mp3-downloader-1/" title="VBS MP3 Downloader">VBS MP3 Downloader</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/malware-tutorials/">Malware Tutorials</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/malware/malware-tutorials/cuckoo-sandbox/" title="Cuckoo sandbox install">Cuckoo sandbox install</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/dev-projects/">Malware Projects</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/malware/dev-projects/simple-vba-bypass-defender/" title="ByPass Defender with Simple VBA">ByPass Defender with Simple VBA</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/raspberry/">üçì Raspberry Projects</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/raspberry/p4wnp1/">P4wnP1</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/raspberry/p4wnp1/p4wnp1-install/" title="P4wnP1 Install">P4wnP1 Install</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/linux-tutorials/">üêß Linux Tutorials</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/linux-tutorials/nixos/">NixOS</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-conf/" title="How to configure NixOS">How to configure NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-install/" title="How to install NixOS">How to install NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-ssh/" title="How to setup SSH on NixOS">How to setup SSH on NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-wireguard/" title="How to setup Wireguard NixOS">How to setup Wireguard NixOS</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/write-up/">üìù Write-Up</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/write-up/vulnhub/">VulnHub</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/vulnhub/bellatrix/" title="Bellatrix - easy">Bellatrix - easy</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/vulnhub/y0usef/" title="Y0usef - easy">Y0usef - easy</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/htb/">üì¶ HackTheBox</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/htb/easy/">Easy</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/htb/easy/windows/">Windows</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/htb/easy/windows/forest/" title="Forest">Forest</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/htb/easy/windows/legacy/" title="Legacy">Legacy</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/images/write-up/htb/forest.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/adrien_hu3506b078850a2b7b20331c4ea2092816_75131_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Adrien</h5>
          <p>Thursday, September 2, 2021</p>
        </div>

        <div class="title">
          <h1>Forest</h1>
        </div>
        
        <div class="post-content" id="post-content">
          <div class="alert alert-info">
    <strong>Re-Post from October 2021, 13rd</strong>
</div>

<h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">NMAP</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo nmap -v -sS -A -Pn 10.10.10.161
</span></span></code></pre></div><p>Simple NMAP scan to check the most commun ports and grab banner or version number.</p>
<img src="nmap.png"
    
        alt="Simple nmap"
    
    
    
    
    
        class="center"
    
>

<p>As we can see, there are a lot of Windows server services as Kerberos, DNS LDAP, &hellip;<br>
The machine is part of the <code>HTB.local</code> network.</p>
<p><strong>Bonus :</strong> Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)</p>
<h3 id="ldapsearch">LDAPSearch</h3>
<p>Since there is an LDAP port, we can try if there is a way to gather information on the LDAP server using ldapsearch with anonymous account.</p>
<img src="ldapsearch.png"
    
        alt="LDAPSearch"
    
    
    
    
    
        class="center"
    
>

<p><strong>Options</strong>:</p>
<ul>
<li><code>h</code> : IP Address of LDAP server</li>
<li><code>p</code> : Port used by LDAP Server, Default is 389</li>
<li><code>x</code> : Anonymous user authentication</li>
<li><code>b</code> : DNS server name</li>
</ul>
<p>Since the <code>null bind</code> is enabled, we can extract 10758 lines on the server.</p>
<blockquote>
<p>‚ÄúThe NULL bind entry allows a user to access the Lightweight Directory Access Protocol (LDAP) directory anonymously. An attacker could take advantage of the NULL bind entry to anonymously view files on the LDAP director.‚Äù
<a href="http://www.iss.net/security_center/reference/vuln/ldap-nullbind.htm">http://www.iss.net/security_center/reference/vuln/ldap-nullbind.htm</a></p>
</blockquote>
<h3 id="windapsearch">WindapSearch</h3>
<p>Here is anther too used to enumerate LDAP Server and <code>null bind</code> misconfiguration<br>
<a href="https://github.com/ropnop/windapsearch">WindapSearch</a></p>
<img src="windapsearch.png"
    
        alt="WindapSearch"
    
    
    
    
    
        class="center"
    
>

<p>Here is an interesting user list</p>
<img src="userlist.png"
    
        alt="UserList"
    
    
    
    
    
        class="center"
    
>

<p>We can see many account for email server. We can enumerate more LDAP object using the filter <code>objectClass=*</code></p>
<img src="object-class.png"
    
        alt="WindapSearch"
    
    
    
    
    
        class="center"
    
>

<p>A lot of users and object but we can see svc user, SPN account.</p>
<img src="spn-user.png"
    
        alt="WindapSearch"
    
    
    
    
    
        class="center"
    
>

<p>Official Documentation <a href="https://docs.alfresco.com/process-services/latest/config/authenticate/#kerberos-and-active-directory">https://docs.alfresco.com/process-services/latest/config/authenticate/#kerberos-and-active-directory</a></p>
<p>Kerberos Pre Auth is not configured, that way we can exploit this using ASREP attack against SPN account and get a TGT<br>
<strong>TGT : Ticket-Granting Ticket</strong></p>
<p>The TGT contains the Hash NTLM of the user account, we can then brute force to get the password.</p>
<h2 id="exploit-spn">Exploit SPN</h2>
<h3 id="getnpusers">GetNPUsers</h3>
<p>For this attack we are going to use <code>GetNPUsers</code> from <code>impacket</code> tool set. <br>
<img src="getnpusers.png"
    
        alt="SPN Attack"
    
    
    
    
    
        class="center"
    
>
</p>
<p>Here is the TGT from <code>svc-alfresco</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$krb5asrep$23$svc-alfresco@HTB.LOCAL:1cf5435125822f347d2cd84de032a835$81fd9e50a029b410d7f228aa441691ea42d8ecae5a55be8d8001fa58ce5ceb87da469c074c2c77c91f00ce9bb0129db6df81ba7a56558499a92fef90494df043f244254a1d8d8057a7642517498da13755b356dcb7dc13296f8da4c5291209cbfb421402802aa2fe0af79c7a74c284a5dafc664d09a8b410af8bc25d163991dcec28573e3326614999d97c1a3778f6e5f8561f4e7a9c99a68181b35d5f1c8135ad4e29e4825face5a2fe784e3f79256531a1405ae707fe712d894342ec41a75383bbcd2897b5b116b5579d125f7005d4478fa3c85858d4c297678d52359e8e54bb5879484ca6
</span></span></code></pre></div><h3 id="johntheripper---crack-tgt">JohnTheRipper - Crack TGT</h3>
<p>Using john we can crack the TGT with rockyou.txt</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>john vc-alfescro.hash --fork<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> -w<span style="color:#f92672">=</span>/usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><img src="john.png"
    
        alt="SPN Attack"
    
    
    
    
    
        class="center"
    
>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>svc-alfresco:S3rvice
</span></span></code></pre></div><h3 id="evil-winrm">Evil-WinRM</h3>
<p>Using Evil WinRM, we can use the WinRM service that is currently enabled on the remote machine and get a sheel using the SPN account found.</p>
<img src="evil-winrm.png"
    
        alt="Evil-WinRm"
    
    
    
    
    
        class="center"
    
>

<h2 id="system-access---flag">System Access - FLAG</h2>
<p>We know have an Initial Access to the system and able to grab the user flag. Now the next step is to found another path to get the root flag and privsec into the system.</p>
<h3 id="bloodhound">Bloodhound</h3>
<p>Bloodhound is a tool that can gather every object on the domain and display it in a nice graph. Using bloodhound we can found weaknesses inside a domain and get an attack path to the domain admins.</p>
<p>The frist step is to execute a collector that can grab all the data and then input the data (JSON files) inside bloodhound itself.</p>
<p>I used the <code>bloodhound-python</code> collector to grab the JSON data from my kali machine.</p>
<img src="bloodhound-python.png"
    
        alt="Bloodhound collector"
    
    
    
    
    
        class="center"
    
>

<p>Once the collector is finish, we can input the archive into bloodhound and mark the SPN as owned, that will draw an attack path to any privileged assets.</p>
<img src="bloodhound.png"
    
        alt="bloodhound path"
    
    
    
    
    
        class="center"
    
>

<p>On the path, we can see that the SPN that we hacked is inside a group called <code>ACCOUNT OPERATORS</code></p>
<img src="group.png"
    
        alt="SPN Group"
    
    
    
    
    
        class="center"
    
>

<p>By looking at the official documentation, we can see that the members of that group can add and remove users inside groups that are not protected.</p>
<p>Using the Bloodhound option <code>Shortest Path to High Value targets</code> we can see something interesting.</p>
<img src="write.png"
    
        alt="Write DACL"
    
    
    
    
    
        class="center"
    
>

<p>We can see that the embers of the group <code>EXCHANGE WINDOWS PERMISSION</code> have the right <code>WriteDacl</code> on the DC, that eans they can create object with ACLs.</p>
<p>We can create a user inside this group and give him the right <code>DCSync</code>.</p>
<h3 id="exploit---dcsync">Exploit - DCSync</h3>
<p>Again with evel-winrm sheel, we can create the user.</p>
<img src="create.png"
    
        alt="Create new user"
    
    
    
    
    
        class="center"
    
>

<p>Now using the script <code>Powerview</code> we can inject the user created with DCSync rights, but first we need to bypass AMSI using Evil-WinRM since there is Defender enabled on the machine.</p>
<img src="amsi.png"
    
        alt="AMSI ByPass"
    
    
    
    
    
        class="center"
    
>

<img src="dcsync.png"
    
        alt="DCSync Rights"
    
    
    
    
    
        class="center"
    
>

<p>The command <code>Add-ObjectACL</code> from <code>powerview</code> can give the dcsync right to our user.</p>
<h3 id="secretdumps">SecretDumps</h3>
<p>Great, we have now a high privileged user, and using <code>secretdumps</code> we can extract all the hashes from the DC and get the Administrator one.</p>
<img src="secretdumps.png"
    
        alt="Extract Hashes"
    
    
    
    
    
        class="center"
    
>

<p>Here is the Administrator Hash : <code>aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6</code></p>
<h3 id="psexecpy">PSEXEC.py</h3>
<p>Using the hash, we don&rsquo;t need the password, since we can use PassTheHash technic and get a shell.</p>
<img src="psexec.png"
    
        alt="psexec admin shell"
    
    
    
    
    
        class="center"
    
>

<h2 id="rooted---flag">Rooted - FLAG</h2>
<p>We are now Administrator of the domain controller, the machine is fully pwned, if we want, we can start the post exploitation and grab avery secret on this machine or create backdoor accounts for later.</p>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
            <strong>Share on:</strong>
            
            <a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f" target="_blank">
              <i class="fab fa-facebook"></i>
            </a>
            
            
                <a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f&text=Forest&via=AlrikRr%27s%20Blog" target="_blank">
                  <i class="fab fa-twitter"></i>
                </a>
            
            
                <a  class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f&title=Forest" target="_blank">
                  <i class="fab fa-reddit"></i>
                </a>
            
            
            
            
                <a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f&title=Forest" target="_blank">
                  <i class="fab fa-linkedin"></i>
                </a>
            
            
             
            
                 <a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Forest https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f" target="_blank">
                  <i class="fab fa-whatsapp"></i>
                </a>
            
            
                <a class="btn btn-sm email-btn" href="mailto:?subject=Forest&body=https%3a%2f%2fAlrikRr.github.io%2fposts%2fhtb%2feasy%2fwindows%2fforest%2f" target="_blank">
                  <i class="fas fa-envelope-open-text"></i>
                </a>
            
          
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/alrikrr/alrikrr.github.io/edit/main/content/posts/htb/easy/windows/forest/index.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
    
    
  
  

  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/posts/write-up/vulnhub/y0usef/" title="Y0usef - easy" class="btn btn-outline-info">
        <div><i class="fas fa-chevron-circle-left"></i> Prev</div>
        <div class="next-prev-text">Y0usef - easy</div>
      </a>
    </div>
  
  
      
      
        
      
      <div class="col-md-6 next-article">
        <a href="/posts/htb/easy/windows/legacy/" title="Legacy" class="btn btn-outline-info">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">Legacy</div>
        </a>
      </div>
    
</div>

      <hr />

      
      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a>
      <ul>
        <li><a href="#nmap">NMAP</a></li>
        <li><a href="#ldapsearch">LDAPSearch</a></li>
        <li><a href="#windapsearch">WindapSearch</a></li>
      </ul>
    </li>
    <li><a href="#exploit-spn">Exploit SPN</a>
      <ul>
        <li><a href="#getnpusers">GetNPUsers</a></li>
        <li><a href="#johntheripper---crack-tgt">JohnTheRipper - Crack TGT</a></li>
        <li><a href="#evil-winrm">Evil-WinRM</a></li>
      </ul>
    </li>
    <li><a href="#system-access---flag">System Access - FLAG</a>
      <ul>
        <li><a href="#bloodhound">Bloodhound</a></li>
        <li><a href="#exploit---dcsync">Exploit - DCSync</a></li>
        <li><a href="#secretdumps">SecretDumps</a></li>
        <li><a href="#psexecpy">PSEXEC.py</a></li>
      </ul>
    </li>
    <li><a href="#rooted---flag">Rooted - FLAG</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    










  
      
  



  
  
    
  

  
  
    
  

  
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#recent-posts">Recent Posts</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#projects">Projects</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#achievements">Achievements</a>
                </li>
              
            
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:adrienlasalle.pro&#43;contact@gmail.com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>adrienlasalle.pro&#43;contact@gmail.com</span>
                </a></li>
              
            
          </ul>
        </div>
        
        
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hossainemruz/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">AlrikRr ¬© 2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



<script type="text/javascript" src="/js/darkreader.js"></script>
<script type="text/javascript" src="/js/darkmode-darkreader.js"></script>



    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>









    
</body>
</html>
