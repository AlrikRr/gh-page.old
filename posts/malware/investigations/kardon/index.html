<!DOCTYPE html>
<html>
  <head>
    <title>Kardon Loader</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>

<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="/google-fonts/Mulish/mulish.css"/>


<link rel="stylesheet" href="/fontawesome/css/all.min.css"/>



<link rel="stylesheet" href="/css/colortheme/colortheme.css"/>





  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" />

<meta property="og:title" content="Kardon Loader" />
<meta property="og:description" content="Investigation of Kardon malware" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://AlrikRr.github.io/posts/malware/investigations/kardon/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-28T00:00:00+00:00" />


    
    
<meta name="description" content="Investigation of Kardon malware" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  


  




  
  
    
  
  



  
  
    
  
  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" alt="Logo">
      AlrikRr&#39;s Blog</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      
        <li class="nav-item dropdown">

<div id="theme-initialization" style="display: none;"
  default-theme="system"></div>
<a class="nav-link dropdown-toggle"  href="#" id="themeSelector" role="button"
  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  <img id="navbar-theme-icon-svg" src="/icons/moon-svgrepo-com.svg" width=20 alt="Dark Theme">
</a>
<div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby="themeSelector">
  <a class="dropdown-item nav-link" href="#" onclick="enableLightTheme()">
    <img class="menu-icon-center" src="/icons/sun-svgrepo-com.svg" width=20 alt="Light Theme">
  </a>
  <a class="dropdown-item nav-link" href="#" onclick="enableDarkTheme()">
    <img class="menu-icon-center" src="/icons/moon-svgrepo-com.svg" width=20 alt="Dark Theme">
  </a>
  <a class="dropdown-item nav-link" href="#" onclick="useSystemTheme()">
    <img class="menu-icon-center" src="/icons/computer-svgrepo-com.svg" width=20 alt="System Theme">
  </a>
</div>
</li>
      
      </ul>
    </div>
  </div>
  
  
    <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/adrien_huf2f5d60ef13d1016ef7a4d62ed3a4d6d_22569_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts/" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/updates/">üßëüèº‚Äçüíª Personal Updates</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/updates/my-crts/" title="My CRTS Feedback">My CRTS Feedback</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/updates/my-ejpt/" title="My eJPT feedback">My eJPT feedback</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/flipper-zero/">üê¨ Flipper Zero</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/flipper-zero/flipper-gpio/">Flipper Zero - GPIO</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/flipper-zero/flipper-gpio/uart-bridge-pi4/" title="UART Bridge RPi4 to Flipper">UART Bridge RPi4 to Flipper</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/flipper-zero/flipper-gpio/tty-shell/" title="USB to tty">USB to tty</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/8bits-computer/">üíæ 8 Bits Computer</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/8bits-computer/part1-clock/">Part 1 - Clock Module</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/1-astable555timer/" title="#1 Astable 555 Timer">#1 Astable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/2-monostable555timer/" title="#2 Monostable 555 Timer">#2 Monostable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/3-bistable555timer/" title="#3 Bistable 555 Timer">#3 Bistable 555 Timer</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/8bits-computer/part1-clock/4-clocklogic/" title="#4 Clock Logic">#4 Clock Logic</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/active-directory/">üñ• Active Directory Posts</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/active-directory/build-training-lab/">Build your Training Lab</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/active-directory/build-training-lab/1-domain/" title="#1 Setup the Domain and Workstations">#1 Setup the Domain and Workstations</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/active-directory/ad-attacks/" title="Hacking &amp; Attacks">Hacking &amp; Attacks</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/">üëæ Reverse Engineering</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/iot-hacking/">IoT Hacking</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/iot-hacking/d-link-dcs-932l/" title="D-Link - DCS-932L">D-Link - DCS-932L</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/iot-hacking/tplink-ac750/" title="#1 TP-Link AC750 Wifi Router">#1 TP-Link AC750 Wifi Router</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/reverse-engineering/binary-exploitation/">Binary Exploitation</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/buffer-overflow/" title="#1 Introduction to linux buffer-overflow 32-bit">#1 Introduction to linux buffer-overflow 32-bit</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/ret-2-win/" title="#2 ret2win exploit 32-bit linux">#2 ret2win exploit 32-bit linux</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/reverse-engineering/binary-exploitation/ret-2-libc/" title="#3 ret2libc exploit 32-bit linux">#3 ret2libc exploit 32-bit linux</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/malware/">ü™≤ Malware</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/malware/investigations/">Investigations</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/malware/investigations/kardon/" title="Kardon Loader">Kardon Loader</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/malware/investigations/vbs-mp3-downloader-1/" title="VBS MP3 Downloader">VBS MP3 Downloader</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/malware-tutorials/">Malware Tutorials</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/malware/malware-tutorials/cuckoo-sandbox/" title="Cuckoo sandbox install">Cuckoo sandbox install</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/malware/dev-projects/">Malware Projects</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/malware/dev-projects/simple-vba-bypass-defender/" title="ByPass Defender with Simple VBA">ByPass Defender with Simple VBA</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/raspberry/">üçì Raspberry Projects</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/raspberry/p4wnp1/">P4wnP1</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/raspberry/p4wnp1/p4wnp1-install/" title="P4wnP1 Install">P4wnP1 Install</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/linux-tutorials/">üêß Linux Tutorials</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/linux-tutorials/nixos/">NixOS</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-conf/" title="How to configure NixOS">How to configure NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-install/" title="How to install NixOS">How to install NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-ssh/" title="How to setup SSH on NixOS">How to setup SSH on NixOS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux-tutorials/nixos/nixos-wireguard/" title="How to setup Wireguard NixOS">How to setup Wireguard NixOS</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/write-up/">üìù Write-Up</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/write-up/nsec-2021/">Nsec-2021 Badge</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/nsec-2021/1-flag/" title="Flag #1 - Welcome">Flag #1 - Welcome</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/nsec-2021/5-flag/" title="Flag #5 - Punk Down">Flag #5 - Punk Down</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/write-up/vulnhub/">VulnHub</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/vulnhub/bellatrix/" title="Bellatrix - easy">Bellatrix - easy</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/write-up/vulnhub/y0usef/" title="Y0usef - easy">Y0usef - easy</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/htb/">üì¶ HackTheBox</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/htb/easy/">Easy</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/htb/easy/windows/">Windows</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/htb/easy/windows/forest/" title="Forest">Forest</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/htb/easy/windows/legacy/" title="Legacy">Legacy</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/images/malware/investigations/banner.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/adrien_hu5e0db9d08f39d865875892cca1af9bf9_56696_120x120_fit_q75_box.jpeg' alt="Author Image">
          <h5 class="author-name">Adrien</h5>
          <p>Friday, January 28, 2022</p>
        </div>

        <div class="title">
          <h1>Kardon Loader</h1>
        </div>
        
        <div class="taxonomy-terms">
          <ul style="padding-left: 0;">
            
            
            <li class="rounded"><a href="/tags/loader/" class="btn, btn-sm">Loader</a></li>
            
            
            <li class="rounded"><a href="/tags/anti-vm/" class="btn, btn-sm">Anti-VM</a></li>
            
            
            <li class="rounded"><a href="/tags/anti-virus/" class="btn, btn-sm">Anti-Virus</a></li>
            
            
            <li class="rounded"><a href="/tags/unpacked/" class="btn, btn-sm">Unpacked</a></li>
            
          </ul>
        </div>
        
        <div class="post-content" id="post-content">
          <h2 id="identification">Identification</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>kardon.exe</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hash (256)</td>
<td>555675C526F80B9C89E02CA9D2C27F0EA61AD400</td>
</tr>
<tr>
<td>FileType</td>
<td>PE 32 bit</td>
</tr>
<tr>
<td>TimeStamp</td>
<td>5AFD5BE1 ‚Äî&gt;¬† GMT: Thursday 17 May 2018 10:39:29</td>
</tr>
<tr>
<td>FileSize</td>
<td>10KB</td>
</tr>
<tr>
<td>ImageBase</td>
<td>000011AD</td>
</tr>
<tr>
<td>EntryPoint(RVA)</td>
<td>00400000</td>
</tr>
<tr>
<td>VA(IB+RVA)</td>
<td>004011AD</td>
</tr>
</tbody>
</table>
<h3 id="sections">Sections</h3>
<p>There are 4 sections :</p>
<ul>
<li>.text</li>
<li>.rdata</li>
<li>.data</li>
<li>.reloc</li>
</ul>
<h3 id="imports">Imports</h3>
<p>Interesting DLLs :</p>
<ul>
<li>urlmon.dll: <em><strong>URLDownloadToFileA()</strong></em></li>
<li>SHELL32.dll: <em><strong>SHGetFolderPathA()</strong></em></li>
<li>KERNEL32.dll: <em><strong>GetCommandLineA(), MoveFileExA(), WinExec(), GetCurrentProcess(), etc.</strong></em></li>
<li>ADVAPI32.dll: <em><strong>RegCreateKeyA(), RegSetValueExA(), etc.</strong></em></li>
</ul>
<blockquote>
<p>üí° The identification of the malware is done, we have a better understanding of the malware at the moment. We can see that it uses some functions, <strong>especially the manipulation of registers and documents</strong>. We can think about a <strong>persistence on our system</strong>. A possibility to <strong>download files from the Internet</strong> with urlmon.dll. Then we can see that there is an <strong>anti-debug system on a virtual machine</strong>. This suggests that the hacker behind this malware doesn&rsquo;t want us to look further into his malware. Now let&rsquo;s move on to the static analysis.</p>
</blockquote>
<h2 id="static-analysis">Static Analysis</h2>
<p>We start our static analysis with the <strong>Hacker Resources</strong> tool. Unfortunately, this did not give us any data. No resources are present in our malware.</p>
<p>We will continue using IDA Pro.</p>
<h3 id="ida-pro---main-address">IDA Pro - Main Address</h3>
<p>First of all, we need to <strong>jump to the main address</strong>. Sometimes you don‚Äôt need to jump, you just spawn on the main function but to do so, just press ‚Äúg‚Äù and enter <strong>the VA that we find earlier</strong>.</p>
<p><img src="Untitled.png" alt="Untitled"></p>
<h3 id="ida-pro---anti-vm--bypass">IDA Pro - Anti-VM &amp; Bypass</h3>
<p>As we saw during the identification of our malware, virtual machine anti-debug functions were present.</p>
<p>These functions, or checks, are there to verify if the malware is running in a virtualization environment or not. In most cases, and [Spoilers] in this one as well, if the malware is running on a virtual machine, it automatically shuts down, in order to avoid it being analyzed.</p>
<p>Fortunately, this kind of protection is easy to bypass.</p>
<p>In the screenshot below you can see at address <strong><code>0x0040148B</code></strong> a function that checks the presence of virtual environments dlls like VMWare, VirtualBox, KVM, etc.</p>
<p><img src="Untitled1.png" alt="Anti-VM check used by Kardon"></p>
<p>Anti-VM check used by Kardon</p>
<p>At the address <strong><code>0x00401521</code></strong>, right after the CheckVM function(<strong><code>0x0040148B</code></strong>).</p>
<p>This variable, to make it simple, is by default at <code>1</code> when passing in this instruction. So, if the malware is in a virtual machine, the variable will be set to <code>1</code>.</p>
<p>The final condition would be, if variable is equal to <code>1</code>, it is a virtual machine, so shutdown. If the variable is equal to <code>0</code>, it&rsquo;s ok, continue.</p>
<p>If you want to see all the function CheckVM, just press ‚Äúspace‚Äù when you‚Äôre on it and you‚Äôll see all the function + instructions.</p>
<p>In our case, it will never be set to 1 because <strong>we will replace the 1 by a 0</strong>.</p>
<p>To do so, just click on the 1 from <strong>‚Äú<code>mov al, 1</code>‚Äù</strong> then in the hexadecimal editor integrated into IDA (Hex View-1), press F2 and change <code>01</code> by <code>00</code>. Like in the example below.</p>
<p><img src="Untitled2.png" alt="Replace 01 by 00 in hexa to by-pass the Anti-VM protection."></p>
<p>Replace 01 by 00 in hexa to by-pass the Anti-VM protection.</p>
<p><strong>This bypass will allow us to execute the malware during the dynamic analysis.</strong></p>
<h3 id="ida-pro---anti-virus-check">IDA-Pro - Anti-Virus check</h3>
<p>At the address <strong><code>0x00401BDC</code></strong> there is a function that we are going to call <strong><code>CheckAV()</code>.</strong> This function will simply check if there are dlls related to AntiVirus protection. Like the <strong><code>CheckVM()</code></strong> function, if these dlls are in the machine, the malware will stop.</p>
<p><img src="Untitled3.png" alt="Anti-Virus dll check used by Kardon"></p>
<p>Anti-Virus dll check used by Kardon</p>
<p>Like the <code>CheckVM()</code> function, this one can be bypass too, using the same method. The instruction is located at the address <strong><code>0x00401C43</code>.</strong></p>
<h3 id="ida-pro---kardon-checking-so-far">IDA-Pro - Kardon Checking so far</h3>
<p>Here is a little recap from the checking in place in this malware ( CheckVM is not here).
As we can see, these checks are coded the same way and can be bypass easily.
The last one is a function that check if the malware is running inside a Wine emulator from Linux.</p>
<p><img src="Untitled4.png" alt="Untitled"></p>
<h3 id="ida-pro---cc">IDA-Pro - C&amp;C</h3>
<p>At the address <strong><code>0x00401AB0</code></strong>, just before the <strong><code>CheckWineLinux()</code></strong> function we can see the C&amp;C used by the malware.</p>
<p>We can also see the name of the page that is trigger, here <strong><code>gate.php</code></strong> into the Kardon folder.</p>
<p><img src="Untitled5.png" alt="Untitled"></p>
<p>This IOC is a very important information, using this we can for example block any communication to the destination of <strong><code>kardon.ddns.net</code></strong>.</p>
<h3 id="ida-pro---registry-key">IDA-Pro - Registry Key</h3>
<p>Last part of this static analysis, at the address <strong><code>0x00401B0B</code></strong> we can see a Registry Key and some system function used for registry key creation and manipulation.</p>
<p>When we start talking about manipulation of the Windows registry, the first thing that comes to our mind is the persistence of malware on the system.</p>
<p>Here we can see a <strong>SubKey</strong> : <strong><code>‚ÄúSOFTWARE\Microsoft\Windows\CurrentVersion\Run‚Äù</code></strong></p>
<p><strong>The Holy Microsoft documentation says:</strong></p>
<blockquote>
<p>‚ÄúRun and RunOnce registry keys cause programs to run each time a user logs on. The data value for a key is a command line no longer than 260 characters.‚Äù</p>
</blockquote>
<p>There is also two <strong>hKey</strong>: <strong><code>‚Äú80000002h‚Äù</code></strong> &amp; <strong><code>‚Äú80000002h‚Äù</code></strong></p>
<p>The value is a const value, here It is easy to find the exact value of the hKey.</p>
<pre tabindex="0"><code>Const HKEY_CLASSES_ROOT     = &amp;H80000000
Const HKEY_CURRENT_USER     = &amp;H80000001
Const HKEY_LOCAL_MACHINE    = &amp;H80000002
Const HKEY_USERS        = &amp;H80000003
Const HKEY_CURRENT_CONFIG   = &amp;H80000005
</code></pre><p>And we can see a lot of system function such as:</p>
<ul>
<li><strong>RegCreateKeyA</strong> : ‚ÄúCreates the specified registry key. If the key already exists in the registry, the function opens it.‚Äù <strong>Here this function is called 2 times so there is a creation and an edit.</strong></li>
<li><strong>GetSystemDirectoryA</strong> : Retrieves the path of the system directory. The system directory contains system files such as dynamic-link libraries and drivers.</li>
<li><strong>SHGetFolderPathA</strong> : ‚Äú Gets the path of a folder identified by a <a href="https://docs.microsoft.com/en-us/windows/desktop/shell/csidl">CSIDL</a> value.‚Äù</li>
</ul>
<p><img src="Untitled6.png" alt="Capture of the HKEY used by Kardon"></p>
<p>Capture of the HKEY used by Kardon</p>
<p>In conclusion, there is the creation of a registry key that allows the malware to execute at each login of the victim. Moreover, we can see a creation and a modification of the key.</p>
<p>We will see in more detail what happens in the dynamic analysis.</p>
<h1 id="dynamic-analysis">Dynamic Analysis</h1>
<blockquote>
<p>‚ö†Ô∏è <strong>Before executing this part, make sure you protect your system properly so as not to damage your computer. Also remember to make a snapshot of your system before each execution.</strong></p>
</blockquote>
<!-- raw HTML omitted -->
<h3 id="procmon">Procmon</h3>
<p>As our malware is patched (Bypass CheckVM, CheckAV, etc.) it runs correctly on the analysis system. The first thing to do is to run Procmon with the correct filters and then run the malware. This will give us a better understanding of how it works on the system.</p>
<p>As suspected, <strong>we see the creation of a registry key but we also see its modification</strong>. This function takes on its full meaning when you look at what happens next. Indeed, we can see our malware being copied into <code>%APPDATA%</code> under a random name and <strong>then adding its new path+name into the registry key</strong>. Which is why we use the <strong><code>GetSystemDirectoryA</code></strong> function seen earlier.</p>
<p>This makes sense because, once executed, the <strong>Kardon.exe malware deletes itself</strong> to leave only <strong>its copy in <code>%APPDATA%</code></strong>. It gets the full path of the copy into the registry Key created before. Every execution, this malware changes it name and the registry key. By the way the name of the autorun key is <strong>‚ÄúMicrosoft Update‚Äù.</strong></p>
<p><img src="Untitled7.png" alt="Untitled"></p>
<h4 id="procmon---conclusion">Procmon - Conclusion</h4>
<p>To conclude, it is possible to push this analysis even further. Indeed, since we have at our disposal the C&amp;C and a better understanding of its behavior, it is possible to create a C&amp;C of the same name so that Kardon communicates with it.</p>
<p>This will allow us to see in more detail the communications and data exchanges between the two.</p>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
            <strong>Share on:</strong>
            
            <a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f" target="_blank">
              <i class="fab fa-facebook"></i>
            </a>
            
            
                <a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f&text=Kardon%20Loader&via=AlrikRr%27s%20Blog" target="_blank">
                  <i class="fab fa-twitter"></i>
                </a>
            
            
                <a  class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f&title=Kardon%20Loader" target="_blank">
                  <i class="fab fa-reddit"></i>
                </a>
            
            
            
            
                <a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f&title=Kardon%20Loader" target="_blank">
                  <i class="fab fa-linkedin"></i>
                </a>
            
            
             
                <a class="btn btn-sm mastodon-btn" href="https://mastodon.social/share?text=Kardon%20Loader - https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f" target="_blank">
                  <i class="fab fa-mastodon"></i>
                </a>
            
            
                 <a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Kardon%20Loader https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f" target="_blank">
                  <i class="fab fa-whatsapp"></i>
                </a>
            
            
                <a class="btn btn-sm email-btn" href="mailto:?subject=Kardon%20Loader&body=https%3a%2f%2fAlrikRr.github.io%2fposts%2fmalware%2finvestigations%2fkardon%2f" target="_blank">
                  <i class="fas fa-envelope-open-text"></i>
                </a>
            
          
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/alrikrr/alrikrr.github.io/edit/main/content/posts/malware/investigations/kardon/index.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
    
    
  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/posts/reverse-engineering/binary-exploitation/ret-2-libc/" title="#3 ret2libc exploit 32-bit linux" class="btn btn-outline-info">
        <div><i class="fas fa-chevron-circle-left"></i> Prev</div>
        <div class="next-prev-text">#3 ret2libc exploit 32-bit linux</div>
      </a>
    </div>
  
  
      
      
        
      
      <div class="col-md-6 next-article">
        <a href="/posts/malware/investigations/vbs-mp3-downloader-1/" title="VBS MP3 Downloader" class="btn btn-outline-info">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">VBS MP3 Downloader</div>
        </a>
      </div>
    
</div>

      <hr />

      
      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#identification">Identification</a>
      <ul>
        <li><a href="#sections">Sections</a></li>
        <li><a href="#imports">Imports</a></li>
      </ul>
    </li>
    <li><a href="#static-analysis">Static Analysis</a>
      <ul>
        <li><a href="#ida-pro---main-address">IDA Pro - Main Address</a></li>
        <li><a href="#ida-pro---anti-vm--bypass">IDA Pro - Anti-VM &amp; Bypass</a></li>
        <li><a href="#ida-pro---anti-virus-check">IDA-Pro - Anti-Virus check</a></li>
        <li><a href="#ida-pro---kardon-checking-so-far">IDA-Pro - Kardon Checking so far</a></li>
        <li><a href="#ida-pro---cc">IDA-Pro - C&amp;C</a></li>
        <li><a href="#ida-pro---registry-key">IDA-Pro - Registry Key</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#procmon">Procmon</a>
          <ul>
            <li><a href="#procmon---conclusion">Procmon - Conclusion</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    










  
      
  



  
  
    
  

  
  
    
  

  
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#recent-posts">Recent Posts</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#projects">Projects</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://AlrikRr.github.io#achievements">Achievements</a>
                </li>
              
            
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:adrienlasalle[dot]pro[&#43;]contact[at]gmail[dot]com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>adrienlasalle[dot]pro[&#43;]contact[at]gmail[dot]com</span>
                </a></li>
              
            
          </ul>
        </div>
        
        
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hugo-toha/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">AlrikRr ¬© 2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



<script type="text/javascript" src="/js/darkreader.js"></script>
<script type="text/javascript" src="/js/darkmode-darkreader.js"></script>



    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>









    
</body>
</html>
